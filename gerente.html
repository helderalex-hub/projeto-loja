<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <title>Gerente | Beleza & Cia</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #fff0f5; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { display: block; width: 100%; margin: 10px 0; padding: 10px; box-sizing: border-box; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .btn-add { background: #d63384; color: white; width: 100%; }
        .btn-sair { background: #666; color: white; float: right; }
        .item { background: white; padding: 15px; margin-top: 10px; border-radius: 8px; border-left: 5px solid #d63384; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <button class="btn-sair" onclick="sair()">Sair üîí</button>
    <h1 style="color: #d63384;">üíÑ Painel de Gest√£o</h1>

    <div class="card">
        <h3>Novo Produto</h3>
        <input type="text" id="nome" placeholder="Nome do Produto">
        <input type="number" id="preco" placeholder="Pre√ßo (‚Ç¨)" step="0.01">
        <input type="number" id="estoque" placeholder="Quantidade em Estoque">
        <button class="btn-add" onclick="salvarProduto()">SALVAR NO INVENT√ÅRIO</button>
    </div>

    <h3>üì¶ Produtos em Stock</h3>
    <div id="lista">Verificando acesso...</div>

    <script>
        const S_URL = 'https://sgamfzcgiexoevnyiehn.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnYW1memNnaWV4b2V2bnlpZWhuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MzIwMDYsImV4cCI6MjA4NDUwODAwNn0.BLdnOWXEpW6w_Ic_0stcOexXXQBWl7Rc5ll0ATjvZVs';
        const API = 'https://projeto-loja-dzqv.onrender.com/produtos';

        const supabase = window.supabase.createClient(S_URL, S_KEY);

        async function verificarAcesso() {
            const { data } = await supabase.auth.getSession();
            if (!data || !data.session) {
                window.location.href = 'login.html';
            } else {
                carregarLista();
            }
        }

        async function sair() {
            await supabase.auth.signOut();
            window.location.href = 'login.html';
        }

        async function carregarLista() {
            const divLista = document.getElementById('lista');
            divLista.innerHTML = "A carregar dados...";
            try {
                const resposta = await fetch(API);
                const produtos = await resposta.json();
                divLista.innerHTML = '';

                produtos.forEach(p => {
                    const preco = parseFloat(p.preco) || 0;
                    divLista.innerHTML += `
                        <div class="item">
                            <div>
                                <strong>${p.nome}</strong><br>
                                <span>‚Ç¨ ${preco.toFixed(2)} | Stock: ${p.estoque}</span>
                            </div>
                            <div>
                                <button style="background:#ff4444; color:white;" onclick="deletarProduto(${p.id})">üóëÔ∏è</button>
                            </div>
                        </div>`;
                });
            } catch (e) {
                divLista.innerHTML = "Erro ao conectar ao servidor. Verifique se o Render est√° ativo.";
            }
        }

        async function salvarProduto() {
            const nome = document.getElementById('nome').value;
            const preco = document.getElementById('preco').value;
            const estoque = document.getElementById('estoque').value;

            if(!nome || !preco) return alert("Preencha os campos!");

            await fetch(API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nome, preco, estoque })
            });
            
            document.getElementById('nome').value = '';
            document.getElementById('preco').value = '';
            document.getElementById('estoque').value = '';
            carregarLista();
        }

        async function deletarProduto(id) {
            if (confirm("Apagar produto?")) {
                await fetch(API + '/' + id, { method: 'DELETE' });
                carregarLista();
            }
        }

        verificarAcesso();
    </script>
</body>
</html>
