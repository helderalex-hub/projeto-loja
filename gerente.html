<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <title>Gerente | Beleza & Cia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; padding: 20px; background: #fff0f5; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; max-width: 500px; margin-left: auto; margin-right: auto; }
        input { display: block; width: 100%; margin: 10px 0; padding: 12px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px; }
        button { width: 100%; padding: 12px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; background: #d63384; color: white; }
        .item { background: white; padding: 15px; margin-top: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #d63384; max-width: 500px; margin-left: auto; margin-right: auto; }
        #status-server { text-align: center; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1 style="text-align: center; color: #d63384;">üíÑ Gest√£o de Stock</h1>
    <div id="status-server" style="color: orange;">Iniciando sistema...</div>

    <div class="card">
        <input type="text" id="nome" placeholder="Nome do Produto">
        <input type="number" id="preco" placeholder="Pre√ßo (‚Ç¨)" step="0.01">
        <input type="number" id="estoque" placeholder="Quantidade">
        <button onclick="salvarProduto()">ADICIONAR PRODUTO</button>
    </div>

    <div id="lista" style="text-align: center;">Aguardando comando...</div>

    <script>
        // URL DO TEU RENDER
        const API = 'https://projeto-loja-dzqv.onrender.com/produtos';

        // 1. FUN√á√ÉO PARA CARREGAR (COM TIMEOUT PARA N√ÉO TRAVAR)
        async function carregarLista() {
            const status = document.getElementById('status-server');
            const lista = document.getElementById('lista');
            
            status.innerText = "üì° Conectando ao Render...";
            
            try {
                const res = await fetch(API);
                if (!res.ok) throw new Error("Erro no servidor");
                
                const produtos = await res.json();
                
                status.innerText = "‚óè ONLINE";
                status.style.color = "green";
                
                lista.innerHTML = '';
                if (produtos.length === 0) {
                    lista.innerHTML = "Invent√°rio vazio.";
                } else {
                    produtos.forEach(p => {
                        lista.innerHTML += `
                            <div class="item">
                                <span><strong>${p.nome}</strong><br>‚Ç¨${p.preco} | Qtd: ${p.estoque}</span>
                                <button onclick="deletar(${p.id})" style="width: auto; background: red; padding: 5px 10px;">X</button>
                            </div>`;
                    });
                }
            } catch (err) {
                console.error(err);
                status.innerText = "üî¥ OFFLINE (Acorde o Render)";
                status.style.color = "red";
                lista.innerHTML = "<button onclick='location.reload()'>Tentar Novamente</button>";
            }
        }

        // 2. FUN√á√ÉO PARA SALVAR
        async function salvarProduto() {
            const n = document.getElementById('nome').value;
            const p = document.getElementById('preco').value;
            const e = document.getElementById('estoque').value;

            if(!n || !p) { alert("Preencha Nome e Pre√ßo!"); return; }

            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ nome: n, preco: p, estoque: e })
                });
                if(res.ok) {
                    document.getElementById('nome').value = '';
                    document.getElementById('preco').value = '';
                    document.getElementById('estoque').value = '';
                    carregarLista();
                }
            } catch (err) {
                alert("Erro ao salvar. Verifique a conex√£o.");
            }
        }

        // 3. FUN√á√ÉO PARA DELETAR
        async function deletar(id) {
            if(!confirm("Apagar produto?")) return;
            await fetch(API + '/' + id, { method: 'DELETE' });
            carregarLista();
        }

        // DISPARO AUTOM√ÅTICO
        console.log("Script carregado. Iniciando fetch...");
        carregarLista();
    </script>
</body>
</html>
