<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Gerente - Beleza & Cia</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #d63384; border-bottom: 2px solid #d63384; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-add { background: #28a745; color: white; margin-top: 10px; }
        .btn-edit { background: #ffc107; color: black; margin-right: 5px; }
        .btn-delete { background: #dc3545; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #d63384; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è Gest√£o de Invent√°rio</h2>
    
    <div id="formulario">
        <input type="hidden" id="prodId">
        <div class="form-group">
            <label>Nome do Produto:</label>
            <input type="text" id="nome" placeholder="Ex: Batom Matte">
        </div>
        <div class="form-group">
            <label>Pre√ßo de Venda (‚Ç¨):</label>
            <input type="number" id="preco" step="0.01">
        </div>
        <div class="form-group">
            <label>Pre√ßo de Entrada (‚Ç¨):</label>
            <input type="number" id="preco_entrada" step="0.01">
        </div>
        <div class="form-group">
            <label>Stock Atual:</label>
            <input type="number" id="estoque">
        </div>
        <div class="form-group">
            <label>Validade:</label>
            <input type="date" id="validade">
        </div>
        <button class="btn-add" onclick="salvarProduto()">Guardar Produto</button>
        <button onclick="limparFormulario()" style="background:#6c757d; color:white;">Cancelar</button>
    </div>

    <table id="tabelaProdutos">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Pre√ßo</th>
                <th>Stock</th>
                <th>Validade</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
</div>

<script>
    const API_URL = "https://projeto-loja-beleza-cia.onrender.com";

    async function carregarProdutos() {
        const res = await fetch(`${API_URL}/produtos`);
        const produtos = await res.json();
        const corpoTabela = document.querySelector("#tabelaProdutos tbody");
        corpoTabela.innerHTML = "";

        produtos.forEach(p => {
            // Formatar data de validade para exibi√ß√£o (DD/MM/AAAA)
            const dataFormatada = p.validade ? new Date(p.validade).toLocaleDateString('pt-PT') : "N/A";
            
            corpoTabela.innerHTML += `
                <tr>
                    <td>${p.nome}</td>
                    <td>‚Ç¨${p.preco.toFixed(2)}</td>
                    <td>${p.estoque}</td>
                    <td>${dataFormatada}</td>
                    <td>
                        <button class="btn-edit" onclick='prepararEdicao(${JSON.stringify(p)})'>‚úèÔ∏è</button>
                        <button class="btn-delete" onclick="eliminarProduto(${p.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `;
        });
    }

    function prepararEdicao(p) {
        document.getElementById("prodId").value = p.id;
        document.getElementById("nome").value = p.nome;
        document.getElementById("preco").value = p.preco;
        document.getElementById("preco_entrada").value = p.preco_entrada || "";
        document.getElementById("estoque").value = p.estoque;
        document.getElementById("validade").value = p.validade || "";
        window.scrollTo(0,0);
    }

    async function salvarProduto() {
        const id = document.getElementById("prodId").value;
        const produto = {
            nome: document.getElementById("nome").value,
            preco: parseFloat(document.getElementById("preco").value),
            preco_entrada: parseFloat(document.getElementById("preco_entrada").value),
            estoque: parseInt(document.getElementById("estoque").value),
            validade: document.getElementById("validade").value
        };

        const metodo = id ? "PUT" : "POST";
        const url = id ? `${API_URL}/produtos/${id}` : `${API_URL}/produtos`;

        const res = await fetch(url, {
            method: metodo,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(produto)
        });

        if (res.ok) {
            alert("Sucesso!");
            limparFormulario();
            carregarProdutos();
        } else {
            alert("Erro ao salvar.");
        }
    }

    async function eliminarProduto(id) {
        if (!confirm("Deseja eliminar este produto?")) return;
        await fetch(`${API_URL}/produtos/${id}`, { method: "DELETE" });
        carregarProdutos();
    }

    function limparFormulario() {
        document.getElementById("prodId").value = "";
        document.getElementById("nome").value = "";
        document.getElementById("preco").value = "";
        document.getElementById("preco_entrada").value = "";
        document.getElementById("estoque").value = "";
        document.getElementById("validade").value = "";
    }

    carregarProdutos();
</script>

</body>
</html>
