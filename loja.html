<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Loja Europeia</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #fdf2f8; color: #333; padding-bottom: 100px; }
        header { background-color: #d63384; color: white; padding: 20px; text-align: center; }
        .vitrine { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .produto-card { background: white; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn-add { background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold;}
        
        /* Barra Inferior */
        .barra-pagamento {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #222; color: white; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.2);
            z-index: 100;
        }
        .btn-pagar { 
            background-color: #635bff; /* Cor oficial do Stripe */
            color: white; border: none; padding: 12px 25px; 
            border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 16px;
            margin-right: 20px; text-decoration: none;
        }
        .btn-pagar:hover { background-color: #4e45e5; }
    </style>
</head>
<body>

    <header>
        <h1>âœ¨ Beleza Europa âœ¨</h1>
        <p>Entregamos em toda UniÃ£o Europeia ðŸ‡ªðŸ‡º</p>
    </header>

    <div class="vitrine" id="vitrine">Carregando...</div>

    <div class="barra-pagamento" id="barra-pagamento" style="display: none;">
        <div style="margin-left: 20px;">
            ðŸ›’ <span id="qtd">0</span> itens <br>
            Total: â‚¬ <span id="total">0.00</span>
        </div>
        <button onclick="finalizarCompra()" class="btn-pagar" id="btn-finalizar">
            Pagar com CartÃ£o ðŸ’³
        </button>
    </div>

    <script>
        const API_URL = 'https://projeto-loja-dzqv.onrender.com'; // Seu servidor
        let carrinho = [];

        async function carregarVitrine() {
            const res = await fetch(`${API_URL}/produtos`);
            const produtos = await res.json();
            const div = document.getElementById('vitrine');
            div.innerHTML = '';

            produtos.forEach(p => {
                div.innerHTML += `
                <div class="produto-card">
                    <h3>${p.nome}</h3>
                    <p style="color:#d63384; font-weight:bold;">â‚¬ ${p.preco}</p>
                    <button class="btn-add" onclick="adicionar('${p.nome}', ${p.preco})">Adicionar +</button>
                </div>`;
            });
        }

        function adicionar(nome, preco) {
            carrinho.push({ nome, preco });
            atualizarBarra();
        }

        function atualizarBarra() {
            document.getElementById('barra-pagamento').style.display = 'flex';
            document.getElementById('qtd').innerText = carrinho.length;
            const total = carrinho.reduce((acc, item) => acc + item.preco, 0);
            document.getElementById('total').innerText = total.toFixed(2);
        }

        async function finalizarCompra() {
            const btn = document.getElementById('btn-finalizar');
            btn.innerText = "Processando...";
            btn.disabled = true;

            try {
                // 1. Envia o carrinho para o Render
                const resposta = await fetch(`${API_URL}/checkout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ itens: carrinho })
                });

                const dados = await resposta.json();

                // 2. Se deu certo, o Render devolve o link do Stripe
                if (dados.url) {
                    window.location.href = dados.url; // Redireciona o cliente
                } else {
                    alert('Erro ao criar pagamento.');
                }
            } catch (erro) {
                alert('Erro de conexÃ£o com o servidor.');
                btn.innerText = "Tentar Novamente";
                btn.disabled = false;
            }
        }

        carregarVitrine();
    </script>
</body>
</html>